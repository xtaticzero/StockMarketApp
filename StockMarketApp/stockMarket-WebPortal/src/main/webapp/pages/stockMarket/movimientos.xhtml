<?xml version="1.0" encoding="UTF-8"?>
<f:view xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html"
        xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:p="http://primefaces.org/ui" >
    <html>
        <h:head>
            <style type="text/css">
                .ui-growl-image-info ~ .ui-growl-message, .ui-growl-item, .ui-growl-item-container{
                    border: #e4e4e4;    
                    background: #e4e4e4;
                    color:#0073ea;
                }
            </style>
        </h:head>
        <h:body>
            <ui:include src="../background.xhtml"/>
            <ui:include src="menuHeader.xhtml"/>
            <div id="panelCentral ui-g" 
                 style="position: absolute;
                 top: 75px;
                 height: 200px;
                 /*                 border: 3px solid #73AD21;*/
                 align-content: center;
                 width: 100%;
                 margin-left:auto;
                 margin-right:auto;">
                <f:event listener="#{cotizacionesMB.preRender}" type="preRenderView" />
                <p:growl id="growl" sticky="true" showDetail="true" life="3000" />
                <h:form prependId="false">

                    <div class="ui-g" style="display: flex; justify-content: center;">
                        <div class="ui-g-12 ui-md-5">
                            <p:panelGrid style="margin-top:20px">
                                <f:facet name="header">
                                    <p:row>
                                        <p:column colspan="2">Compra</p:column>
                                    </p:row>
                                </f:facet>
                                <p:row>
                                    <p:column style="font-weight: bold;">Emisora:</p:column>
                                    <p:column>
                                        <p:selectOneMenu id="emisoras" value="#{movimientoMB.selectEmisora}"
                                                         style="width:125px" >
                                            <p:ajax listener="#{movimientoMB.changeEmisora}" update="iTCostUnit"/>
                                            <f:selectItems value="#{movimientoMB.emisoras}" var="emisora" 
                                                           itemLabel="#{emisora.nombre}" itemValue="#{emisora.emisora_id}" />
                                        </p:selectOneMenu>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="font-weight: bold;">Costo Unitario:</p:column>
                                    <p:column>
                                        <p:inputText id="iTCostUnit" value="#{movimientoMB.accion.costoUnitario}" style="width:165px">
                                            <p:ajax update="oLTotal" listener="#{movimientoMB.calculaTotalCompra}" />
                                        </p:inputText>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="font-weight: bold;">Comisi√≥n:</p:column>
                                    <p:column>
                                        <p:outputLabel value="0.00174"/>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="font-weight: bold;">Cantidad:</p:column>
                                    <p:column>
                                        <p:inputText value="#{movimientoMB.accion.existencia}" style="width:165px">
                                            <p:ajax update="oLTotal" listener="#{movimientoMB.calculaTotalCompra}" />
                                        </p:inputText>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column style="font-weight: bold;">Total:</p:column>
                                    <p:column>
                                        <p:outputLabel id="oLTotal" value="#{movimientoMB.totalCompra}">
                                            <f:convertNumber maxFractionDigits="4" />
                                        </p:outputLabel>
                                    </p:column>
                                </p:row>
                                <p:row>
                                    <p:column colspan="2">
                                        <p:commandButton value="Comprar" action="#{movimientoMB.agregaCompra}" update="growl,dtCapAcc,iTCapInit"/>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>

                        </div>
                        <div class="ui-g-12 ui-md-2">
                            <p:panelGrid style="margin-top:20px">
                                <f:facet name="header">
                                    <p:row>
                                        <p:column>Capital Inicial</p:column>
                                    </p:row>
                                </f:facet>
                                <p:row>
                                    <p:column>
                                        <p:inputText id="iTCapInit" value="#{movimientoMB.capitalInit}" style="width:165px">
                                            <f:convertNumber maxFractionDigits="4" locale="es_MX"/>
                                        </p:inputText>
                                    </p:column>
                                </p:row>
                            </p:panelGrid>
                        </div>
                    </div>

                    <p:dataTable id="dtCapAcc" value="#{movimientoMB.transacciones}" var="tran"
                                 editable="true"
                                 expandableRowGroups="true" sortBy="#{tran.capaAccion.capa.emisora.nombre}">
                        <p:headerRow>
                            <p:column colspan="9">
                                <h:outputText value="#{tran.capaAccion.capa.emisora.nombre}" />
                            </p:column>
                        </p:headerRow>
                        <p:column headerText="Fecha">
                            <h:outputText value="#{tran.fechaTransaccion}" >
                                <f:convertDateTime pattern="MM/dd/yyyy" />
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Entrada">
                            <h:outputText value="#{tran.cantidad}" />
                        </p:column>
                        <p:column headerText="Salida">
                            <p:cellEditor>
                                <f:facet name="output"><h:outputText value="0" /></f:facet>
                                <f:facet name="input"><p:inputText value="" style="width:100%"/></f:facet>
                            </p:cellEditor>
                        </p:column>
                        <p:column headerText="Precio Compra">
                            <h:outputText value="$#{tran.costoUnitario}" />
                        </p:column>
                        <p:column headerText="Precio Venta">
                            <h:outputText value="" />
                        </p:column>
                        <p:column headerText="Total">
                            <h:outputText value="#{tran.total}" >
                                <f:convertNumber maxFractionDigits="4" locale="es_MX"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="Utilidad">
                            <h:outputText value="#{tran.utilidad}" >
                                <f:convertNumber maxFractionDigits="4" locale="es_MX"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="% Sobre Venta">
                            <h:outputText value="#{tran.porcentajeMovimiento}" >
                                <f:convertNumber maxFractionDigits="4" type="percent" locale="es_MX"/>
                            </h:outputText>
                        </p:column>
                        <p:column headerText="">
                            <p:button value="Venta"/>
                        </p:column>
                        <p:summaryRow>
                            <p:column style="text-align:right">
                                <h:outputText value="Total:" />
                            </p:column>
                            <p:column>
                                <h:outputText value="#{movimientoMB.totalEntradas(tran.capaAccion.capa.emisora)}">
                                    <f:convertNumber maxFractionDigits="4" locale="es_MX"/>
                                </h:outputText>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{movimientoMB.totalSalidas(tran.capaAccion.capa.emisora)}">
                                    <f:convertNumber maxFractionDigits="4" locale="es_MX"/>
                                </h:outputText>
                            </p:column>
                            <p:column>
                                <h:outputText value="$#{movimientoMB.totalPrecioCompras(tran.capaAccion.capa.emisora)}">
                                    <f:convertNumber maxFractionDigits="4" locale="es_MX"/>
                                </h:outputText>
                            </p:column>
                            <p:column>
                                <h:outputText value="$#{movimientoMB.totalPrecioVentas(tran.capaAccion.capa.emisora)}">
                                    <f:convertNumber maxFractionDigits="4" locale="es_MX"/>
                                </h:outputText>
                            </p:column>
                            <p:column>
                                <h:outputText value="$#{movimientoMB.totalTotales(tran.capaAccion.capa.emisora)}">
                                    <f:convertNumber maxFractionDigits="4" locale="es_MX"/>
                                </h:outputText>
                            </p:column>
                            <p:column>
                                <h:outputText value="$#{movimientoMB.totalUtilidades(tran.capaAccion.capa.emisora)}">
                                    <f:convertNumber maxFractionDigits="4" />
                                </h:outputText>
                            </p:column>
                            <p:column>
                                <h:outputText value="#{movimientoMB.porcentajeTotales(tran.capaAccion.capa.emisora)}">
                                    <f:convertNumber maxFractionDigits="4" type="percent" locale="es_MX"/>
                                </h:outputText>
                            </p:column>
                            <p:column/>
                        </p:summaryRow>
                    </p:dataTable>

                </h:form>
            </div>
        </h:body>
    </html>
</f:view>